(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{170:function(t,a,e){"use strict";e.r(a);var n=e(0),s=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"content"},[e("h1",{attrs:{id:"relocating-packages"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#relocating-packages","aria-hidden":"true"}},[t._v("#")]),t._v(" Relocating Packages")]),t._v(" "),e("p",[t._v("Shadow is capable of scanning a project's classes and relocating specific dependencies to a new location.\nThis is often required when one of the dependencies is susceptible to breaking changes in versions or\nto classpath pollution in a downstream project.")]),t._v(" "),e("blockquote",[e("p",[t._v("Google's Guava and the ASM library are typical cases where package relocation can come in handy.")])]),t._v(" "),e("p",[t._v("Shadow uses the ASM library to modify class byte code to replace the package name and any import\nstatements for a class.\nAny non-class files that are stored within a package structure are also relocated to the new location.")]),t._v(" "),e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// Relocating a Package")]),t._v("\nshadowJar "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   relocate "),e("span",{attrs:{class:"token string"}},[t._v("'junit.framework'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'shadow.junit'")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("The code snippet will rewrite the location for any class in the "),e("code",[t._v("junit.framework")]),t._v(" to be "),e("code",[t._v("shadow.junit")]),t._v(".\nFor example, the class "),e("code",[t._v("junit.textui.TestRunner")]),t._v(" becomes "),e("code",[t._v("shadow.junit.TestRunner")]),t._v(".\nIn the resulting JAR, the class file is relocated from "),e("code",[t._v("junit/textui/TestRunner.class")]),t._v(" to\n"),e("code",[t._v("shadow/junit/TestRunner.class")]),t._v(".")]),t._v(" "),e("blockquote",[e("p",[t._v("Relocation operates at a package level.\nIt is not necessary to specify any patterns for matching, it will operate simply on the prefix\nprovided.")])]),t._v(" "),e("blockquote",[e("p",[t._v("Relocation will be applied globally to all instance of the matched prefix.\nThat is, it does "),e("strong",[t._v("not")]),t._v(" scope to "),e("em",[t._v("only")]),t._v(" the dependencies being shadowed.\nBe specific as possible when configuring relocation as to avoid unintended relocations.")])]),t._v(" "),e("h2",{attrs:{id:"filtering-relocation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#filtering-relocation","aria-hidden":"true"}},[t._v("#")]),t._v(" Filtering Relocation")]),t._v(" "),e("p",[t._v("Specific classes or files can be "),e("code",[t._v("included")]),t._v("/"),e("code",[t._v("excluded")]),t._v(" from the relocation operation if necessary.")]),t._v(" "),e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// Configuring Filtering for Relocation")]),t._v("\nshadowJar "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),e("span",{attrs:{class:"token function"}},[t._v("relocate")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'junit.textui'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'a'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       exclude "),e("span",{attrs:{class:"token string"}},[t._v("'junit.textui.TestRunner'")]),t._v("\n   "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),e("span",{attrs:{class:"token function"}},[t._v("relocate")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{attrs:{class:"token string"}},[t._v("'junit.framework'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{attrs:{class:"token string"}},[t._v("'b'")]),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       include "),e("span",{attrs:{class:"token string"}},[t._v("'junit.framework.Test*'")]),t._v("\n   "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"automatically-relocating-dependencies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#automatically-relocating-dependencies","aria-hidden":"true"}},[t._v("#")]),t._v(" Automatically Relocating Dependencies")]),t._v(" "),e("p",[t._v("Shadow ships with a task that can be used to automatically configure all packages from all dependencies to be relocated.\nThis feature was formally shipped into a 2nd plugin ("),e("code",[t._v("com.github.johnrengelman.plugin-shadow")]),t._v(") but has been\nremoved for clarity reasons in version 4.0.0.")]),t._v(" "),e("p",[t._v("To configure automatic dependency relocation, declare a task of type "),e("code",[t._v("ConfigureShadowRelocation")]),t._v(" and configure the\n"),e("code",[t._v("target")]),t._v(" parameter to be the "),e("code",[t._v("ShadowJar")]),t._v(" task you wish to auto configure. You will also need to declared a task\ndependency so the tasks execute in the correct order.")]),t._v(" "),e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[e("span",{attrs:{class:"token comment"}},[t._v("// Configure Auto Relocation")]),t._v("\ntask "),e("span",{attrs:{class:"token function"}},[t._v("relocateShadowJar")]),e("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),e("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ConfigureShadowRelocation"),e("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    target "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" tasks"),e("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("shadowJar\n    prefix "),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{attrs:{class:"token string gstring"}},[t._v('"myapp"')]),t._v(" "),e("span",{attrs:{class:"token comment"}},[t._v('// Default value is "shadow"')]),t._v("\n\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ntasks"),e("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("shadowJar"),e("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("dependsOn tasks"),e("span",{attrs:{class:"token operator"}},[t._v(".")]),t._v("relocateShadowJar\n")])])]),e("blockquote",[e("p",[t._v("Configuring package auto relocation can add significant time to the shadow process as it will process all dependencies\nin the configurations declared to be shadowed. By default, this is the "),e("code",[t._v("runtime")]),t._v(" or "),e("code",[t._v("runtimeClasspath")]),t._v(" configurations.\nBe mindful that some Gradle plugins (such as "),e("code",[t._v("java-gradle-plugin")]),t._v(" will automatically add dependencies to your class path\n(e.g. "),e("code",[t._v("java-gradle-plugin")]),t._v(" automatically adds the full Gradle API to your "),e("code",[t._v("compile")]),t._v(" configuratinon. You may need to\nremove these dependencies if you do not intend to shadow them into your library.")])])])}],!1,null,null,null);s.options.__file="README.md";a.default=s.exports}}]);